{% extends "PrimeraApp/main.html" %}
{% load static %}

<!-- Bloque para el contenido principal de la página -->
{% block contenido %}
    <hr>
    <div style="width: 80%; margin: 20px auto;">
        <h2>Consumo Eléctrico en Tiempo Real</h2>
        <canvas id="consumptionChart"></canvas>
    </div>
{% endblock contenido %}


<!-- Bloque para el JavaScript de la página -->
{% block js %}

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
     // Configurar el gráfico inicial
     const ctx = document.getElementById('consumptionChart').getContext('2d');
     const consumptionChart = new Chart(ctx, {
         type: 'line',
         data: {
             labels: [], // Fechas (se actualizarán dinámicamente)
             datasets: [{
                 label: 'Consumo en kWh',
                 data: [], // Valores (se actualizarán dinámicamente)
                 borderColor: 'rgba(75, 192, 192, 1)',
                 backgroundColor: 'rgba(75, 192, 192, 0.2)',
                 tension: 0.4
             }]
         },
         options: {
             responsive: true,
             scales: {
                 x: {
                     title: {
                         display: true,
                         text: 'Fecha'
                     }
                 },
                 y: {
                     title: {
                         display: true,
                         text: 'Consumo (kWh)'
                     }
                 }
             }
         }
     });

     // Función para actualizar el gráfico con datos de la API
     async function updateChart() {
         try {
             const response = await fetch('/mediciones/'); // Endpoint de tu API
             const data = await response.json();

             // Actualizar etiquetas (fechas) y datos (consumo)
             const labels = data.map(entry => new Date(entry.fecha).toLocaleString());
             const values = data.map(entry => entry.valor);

             consumptionChart.data.labels = labels;
             consumptionChart.data.datasets[0].data = values;

             // Refrescar el gráfico
             consumptionChart.update();
         } catch (error) {
             console.error('Error al actualizar el gráfico:', error);
         }
     }

     // Actualizar el gráfico cada 5 segundos
     setInterval(updateChart, 5000);

     // Actualización inicial
     updateChart();
</script>

{% endblock js %}
